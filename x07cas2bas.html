<!DOCTYPE html>
<html lang="en">
	<!-- TO DO: correct indentation and complete data info - better html to do -->
	<head>
		<!-- Meta information -->
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<meta name="description" content="Convert a CAS file Canon X07 emulator to a BASIC text file.">
		<meta name="author" content="VincentD">
		<!-- Page title -->
		<title>RPUFOS X07 CAS to BAS</title>
		<!-- CSS stylesheet -->
		<link rel="stylesheet" href="css/styles.css">
		<link rel="stylesheet" href="css/x07.css">
		<!-- CSS if FOUC -->
		<!--
		<link rel="preload" href="styles.css" as="style" onload="this.rel='stylesheet'">
		<noscript><link rel="stylesheet" href="style.css"></noscript>
		-->
		<!-- Favicon (optional) -->
		<link rel="icon" href="Logos/RPUFOS_Logo.ico" type="image/x-icon">
		<!-- Scripts -->
		<script src="js/general.js" defer></script>
		<script src="js/x07tokens.js" defer></script>
		<script src="js/x07cas2bas.js" defer></script>
	</head>
	<!--  -->
	<body>
		<!-- Header section -->
		<header>
			<div class="header-container">
				<a href="index.html">
					<img src="Logos/RPUFOS_Logo-512.png" alt="Logo" class="logo" />
				</a>
				<h1>CAS to BAS converter<br />(Canon X-07)</h1>
			</div>
		</header>
		<hr />
		<!-- Main content -->
		<main>
			<h3>Objective</h3>
			<p>The goal is to convert Canon X07 CAS file (hex file) into BASIC texte program (UTF-8).</p>
			<h3>Problems</h3>
			<p>A lot....</p>
			<h3>How to</h3>
			<p>Convert CAS is currently in beta test.<br />
			Load the file, convert, if ok, save it (donwload folder).</p>
			<hr />
			<button id="loadBtn">Load</button>
			<button id="buildBtn">Convert</button>
			<button id="saveBtn">Save</button>
			<hr />

			<!-- File name display -->
			<span id="filename">No file loaded...</span>			
			<hr />			
			<!-- Two textareas side by side -->
			<div style="display:flex; gap: 12px; align-items:flex-start; justify-content:center;">
				<!-- Left textarea -->
				<div style="flex:1;">
					<fieldset>
					<legend>CAS (hex view)</legend>
					<div class="text-size-controls">
						<button id="leftFontInc">A+</button>
						<button id="leftFontDec">A-</button>
					</div>
					<textarea id="leftArea" readonly>CAS here...</textarea>
					</fieldset>
				</div>
				<!-- Right textarea -->
				<div style="flex:1;">
				<fieldset>
					<legend>Basic</legend>
					<div class="text-size-controls">
						<button id="rightFontInc">A+</button>
						<button id="rightFontDec">A-</button>
					</div>
					<textarea id="rightArea" readonly>BASIC content...</textarea>
					</fieldset>
				</div>
			</div>
			<!--  -->
			<section>
				<h3 class="collapsible">TO DO</h3>
				<div class="collapsible-content">
					<p>Improve the tokens (X07Tokens.js)</p>
				</div>
				<h3 class="collapsible">The decrypted CAS binary</h3>
				<div class="collapsible-content">
					<p>The CAS file structure for Canon X‑07 programs.</p>
					<h4>Leader / Sync header</h4>
					<p>10 bytes filled with D3h (used as synchronization leader).</p>
					<pre>d3 d3 d3 d3 d3 d3 d3 d3 d3 d3</pre>
					<h4>Program name</h4>
					<p>6 ASCII characters (basename of the file), padded with 00h if shorter.</p>
					<pre>6e 6e 6e 6e 6e 6e</pre>
					<h4>Program body</h4>
					<p>
					Each BASIC line is stored as a block:<br />
					• 2 bytes: pointer to next line (little endian)<br />
					• 2 bytes: line number (little endian)<br />
					• Encoded tokens/ASCII for the line content<br />
					• End of line marker: 00h
					</p>
					<pre>pp pp nn nn [tokens...] 00</pre>
					<h4>Line chaining</h4>
					<p>
					The first two bytes of each block are the pointer to the next line in memory.<br />
					This creates a linked list of lines starting at BASIC area address 0553h.
					</p>
					<h4>End of program marker</h4>
					<p>
					After the last line, the pointer is set to 0000h to mark the end of the program.
					</p>
					<pre>00 00</pre>
					<h4>Trailer</h4>
					<p>
					The CAS file ends with a fixed sequence of 11 zero bytes.<br />
					This marks the termination of the tape image.
					</p>
					<pre>00 00 00 00 00 00 00 00 00 00 00</pre>
				</div>
			</section>
		<!--  -->		</main>
		<hr />
		<!-- Footer section -->
		<footer>
			<img src="Logos/CC-BY-NC-ND-EU.png" alt="CC by NC ND EU" />
			<p>&copy; 2025 VincentD - RPUFOS Work Tools</p>
		</footer>


		
	</body>
	
</html>

<!-- EOF -->
